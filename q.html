<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=0">
<title>問題画面 - Quiz</title>
<style>
[v-cloak] { display:none }
.ranking img { width: 20px; height: 20px; }
</style>
</head>
<body>

<header>
    <h1>Quiz</h1>
</header>

<main v-cloak>
    <section>
        <h2 v-show="num">Q.{{num}}</h2>
        <p>{{quiz}}</p>
        <ol>
           <li v-repeat="ex">{{$value}}</li>
        </ol>
    </section>
    <time>あと{{time}}秒</time>
    <button id="btn_next" v-on="click: changeQ()">Next</button>
</main>

<hr>
<main class="ranking">
    <h2>ランキング</h2>
    <ol>
        <li><img src="https://avatars2.githubusercontent.com/u/8349175?v=3&s=460">moritakenji</li>
        <li><img src="https://avatars2.githubusercontent.com/u/6580754?v=3&s=460">sao-murakami</li>
        <li><img src="https://avatars2.githubusercontent.com/u/7579236?v=3&s=460">y-nishino</li>
        <li><img src="https://avatars0.githubusercontent.com/u/6120877?v=3&s=460">mdb-konno</li>
    </ol>
</main>

<footer>©MeHerBu</footer>

<script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/vue/0.10.5/vue.min.js"></script>
<script src='https://cdn.mlkcca.com/v2.0.0/milkcocoa.js'></script>
<script src="src/js/app.js"></script>
<script>
// --------------------------------------------------------
// Setting
// --------------------------------------------------------
var $btn_next = $('#btn_next');
var intervalTime = 1000; // 1秒
var countTime = 5;
var sec = countTime;


// --------------------------------------------------------
// View
// --------------------------------------------------------
var vue = new Vue({
    el: 'main',
    data: {
        num: '',
        quiz: '',
        ex: '',
        time: sec
    },

    methods:{
        // JSONを取得
        getJson: function(){
            $.getJSON(jsonPath).done(function(data){
                qaJson = data;
                getObjLength(qaJson);
                vue.changeQ(qaJson);
            });
        },

        // 問題を切り替える処理
        changeQ: function(){
            var that = this;
            ++actNum;

            // 次の問題をデータバインド
            if(actNum <= maxNum) {
                that.$set('num', actNum);
                that.$set('quiz', qaJson['q' + actNum].question);
                that.$set('ex', _.values(qaJson['q' + actNum].answer));
            }
            if(actNum == maxNum) {
                // 最後の問題になったら、NextボタンをOFFにする
                $btn_next.attr('disabled', 'disabled');
            }

            // 回答画面にデータを送信
            vue.sendDS(actNum, that.$get('ex'));
        },

        // データストア
        sendDS: function(actNum, ex){
            DS.send({
                DSactNum : actNum, // 問題数
                DSmaxNum : _.values(ex).length // 回答数
            });
        },

        countDowon: function(){
            sec--;
            vue.$set('time', sec);

            if(sec == 0) {
                // clearInterval(timer);
                vue.changeQ();
                sec = countTime;
                vue.$set('time', sec);
            }
        }
    }
});


// --------------------------------------------------------
// Load
// --------------------------------------------------------
// 初回描画
vue.getJson();

var timer = setInterval(vue.countDowon, intervalTime);

</script>

</body>
</html>